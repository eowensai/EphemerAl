/* ===================================================================
 * EphemerAl Theme CSS
 * Tested on: Streamlit 1.52.2
 * 
 * âš ï¸  FRAGILE SELECTORS WARNING
 * This file uses Streamlit internal DOM selectors that may break on upgrades:
 *   - data-testid="stSidebar", "stBottom", "stChatMessage", etc.
 *   - button[title="View fullscreen"] (especially brittle)
 *   - [class*="st-key-..."] pattern for role-based message styling
 * 
 * Validate these selectors when upgrading Streamlit versions.
 * =================================================================== */

/* ===================================================================
 * ðŸŽ¨ CUSTOMIZE YOUR COLORS
 * 
 * Change these values to match your organization's branding.
 * The warm parchment defaults work well with most logos.
 * 
 * For a cooler/neutral feel, try:
 *   --color-bg-main: #F8F8F8;
 *   --color-bg-sidebar: #F0F0F0;
 *   --color-border: #E0E0E0;
 * =================================================================== */
:root {
    color-scheme: light;
    
    /* â”€â”€â”€ LAYOUT â”€â”€â”€ */
    --sidebar-width: 280px;
    
    /* â”€â”€â”€ PRIMARY ACCENT (buttons, user messages, highlights) â”€â”€â”€ */
    --color-accent:           #E1654A;
    
    /* â”€â”€â”€ SECONDARY ACCENT (assistant messages, wordmark gradient) â”€â”€â”€ */
    --color-accent-secondary: #5A4FCF;
    
    /* â”€â”€â”€ BACKGROUNDS â”€â”€â”€ */
    --color-bg-main:          #FAF6F0;
    --color-bg-sidebar:       #F3EEE6;
    
    /* â”€â”€â”€ SURFACES & BORDERS â”€â”€â”€ */
    --color-surface:          #FFFFFF;
    --color-border:           #E6DED3;
    
    /* â”€â”€â”€ TEXT COLORS (usually don't need to change) â”€â”€â”€ */
    --color-text:             #1E242B;
    --color-text-muted:       #5A646E;
    --color-text-subtle:      #7A848E;
    
    /* â”€â”€â”€ MESSAGE BACKGROUNDS â”€â”€â”€ */
    /* User messages get a warm tint, assistant messages stay white */
    --color-user-msg-bg:      #FDF8F4;
    --color-user-msg-border:  #E8A090;
    --color-asst-msg-border:  #A9A3E0;
}

/* ===================================================================
 * System Font Stack (air-gapped, no external fonts)
 * =================================================================== */
html, body, .stApp, .stChatMessage, .stButton > button {
    font-family:
        ui-sans-serif,
        system-ui,
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI Variable",
        "Segoe UI",
        Roboto,
        "Helvetica Neue",
        Arial,
        "Noto Sans",
        Ubuntu,
        Cantarell,
        "Liberation Sans",
        "DejaVu Sans",
        sans-serif,
        "Apple Color Emoji",
        "Segoe UI Emoji",
        "Segoe UI Symbol";
}

/* ===================================================================
 * Hide Streamlit Chrome
 * =================================================================== */
#MainMenu, header, footer, .stDeployButton,
[data-testid="stToolbar"],
[data-testid="stStatusWidget"] {
    display: none !important;
}

/* ===================================================================
 * Layout & Base Styling
 * =================================================================== */
html, body {
    overflow-x: hidden;
    -webkit-text-size-adjust: 100%;
}

/* Main app background */
.stApp {
    background: var(--color-bg-main) !important;
}

/* Sidebar */
section[data-testid="stSidebar"] {
    width: var(--sidebar-width) !important;
    background: var(--color-bg-sidebar) !important;
    padding-top: 0.5rem;
    border-right: 1px solid var(--color-border) !important;
}

section[data-testid="stSidebar"] > div {
    background: var(--color-bg-sidebar) !important;
}

/* Main content area */
.main .block-container {
    background: var(--color-bg-main);
    padding: 2rem 2rem 2rem 1rem;
    max-width: 1200px;
}

/* ===================================================================
 * Typography
 * =================================================================== */
.stChatMessage p,
.stChatMessage li,
.stChatMessage blockquote,
.stChatMessage code,
.stChatInput textarea {
    font-size: 1.05rem !important;
    line-height: 1.5;
    color: var(--color-text);
}

.stChatMessage code {
    font-family:
        ui-monospace,
        "SFMono-Regular",
        Menlo,
        Monaco,
        Consolas,
        "Liberation Mono",
        "DejaVu Sans Mono",
        monospace;
}

/* ===================================================================
 * Welcome Banner
 * =================================================================== */
.welcome-text {
    text-align: center;
    padding: 4rem 1rem 2rem 1rem;
    font-family: inherit;
}

/* Image-based wordmark (default) */
.welcome-wordmark {
    max-height: 60px;
    width: auto;
    margin-top: 0.5rem;
}

/* Text-based wordmark (fallback when image not present) */
.welcome-text .ephemer {
    font-size: 2.4em;
    font-weight: 700;
    letter-spacing: -0.5px;
    color: var(--color-accent);
}

.welcome-text .al {
    font-size: 2.4em;
    font-weight: 700;
    letter-spacing: -0.5px;
    color: var(--color-accent-secondary);
}

/* Instruction block below welcome */
.right-align-block {
    text-align: center;
    margin-top: 0.5rem;
    line-height: 1.6;
    font-size: 1rem;
    color: var(--color-text-muted);
    font-weight: 400;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    padding: 0 1rem;
}

/* Dot separators in welcome text */
.welcome-dots {
    text-align: center;
    margin: 0.7rem 0;
    font-size: 8px;
    color: var(--color-text-subtle);
    letter-spacing: 8px;
}

/* ===================================================================
 * Buttons
 * =================================================================== */
.stButton > button {
    width: 100%;
    background: var(--color-surface);
    color: var(--color-text);
    border: 2px solid var(--color-accent);
    font-weight: 600;
    font-size: 0.95rem;
    padding: 0.7rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    cursor: pointer;
}

.stButton > button:hover {
    background: var(--color-accent);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
}

.stButton > button:active {
    background: #C4503A !important;
    color: white !important;
    transform: translateY(0);
}

/* ===================================================================
 * Chat Messages - Role Distinction
 * 
 * CSS CONTRACT: ephemeral_app.py wraps each chat_message in a container
 * with a key formatted as "{role}-{message_id}" (e.g., "user-abc123").
 * Streamlit renders this as a class containing "st-key-user-" or 
 * "st-key-assistant-" which we target here.
 * 
 * The trailing hyphen in the selector prevents false matches on other
 * containers that might have "user" or "assistant" elsewhere in their key.
 * =================================================================== */

/* Base chat message styling */
[data-testid="stChatMessage"] {
    border-radius: 10px;
    margin: 0.4rem 0;
    padding: 0.1rem 0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
}

/* User messages - warm tint with accent border */
[class*="st-key-user-"] [data-testid="stChatMessage"] {
    background: var(--color-user-msg-bg) !important;
    border-left: 3px solid var(--color-user-msg-border);
}

/* Assistant messages - clean white with secondary accent border */
[class*="st-key-assistant-"] [data-testid="stChatMessage"] {
    background: var(--color-surface) !important;
    border-left: 3px solid var(--color-asst-msg-border);
}

/* Avatar colors */
[data-testid="chatAvatarIcon-user"] {
    background-color: var(--color-accent) !important;
}

[data-testid="chatAvatarIcon-assistant"] {
    background-color: var(--color-accent-secondary) !important;
}

/* Image thumbnails in chat */
.stChatMessage img {
    max-width: 180px;
    border-radius: 6px;
    margin: 0.25rem 0;
}

/* Remove fullscreen button inside chat bubbles */
.stChatMessage [data-testid="stElementToolbar"],
.stChatMessage button[title="View fullscreen"] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
}

/* ===================================================================
 * Chat Input - Minimal styling (production-safe)
 * 
 * Strategy: Only customize focus color, let Streamlit handle layout.
 * This avoids fighting with the multiline expansion and file upload UI.
 * =================================================================== */

/* Fix the bottom dock background (the white slab behind chat input) */
[data-testid="stBottom"] > div {
    background: var(--color-bg-main) !important;
}

[data-testid="stBottomBlockContainer"] {
    background: var(--color-bg-main) !important;
}

/* Only style focus state - don't override structure */
[data-testid="stChatInput"] > div:focus-within {
    border-color: var(--color-accent) !important;
    box-shadow: 0 0 0 1px var(--color-accent) !important;
}

/* ===================================================================
 * Evaporation Edge - Subtle top fade
 * Uses --sidebar-width variable to stay aligned with sidebar
 * =================================================================== */
.main .block-container::before {
    content: "";
    position: fixed;
    top: 0;
    left: var(--sidebar-width);
    right: 0;
    height: 60px;
    background: linear-gradient(
        to bottom,
        var(--color-bg-main) 0%,
        var(--color-bg-main) 40%,
        transparent 100%
    );
    pointer-events: none;
    z-index: 100;
}

/* ===================================================================
 * Sidebar Elements
 * =================================================================== */
/* Logo spacing */
section[data-testid="stSidebar"] img:first-of-type {
    margin-bottom: 1.5rem;
}

/* Hide hover-toolbar in sidebar */
section[data-testid="stSidebar"] [data-testid="stElementToolbar"],
section[data-testid="stSidebar"] button[title="View fullscreen"] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
}

/* Error/warning boxes in sidebar */
section[data-testid="stSidebar"] .stAlert {
    font-size: 0.85rem;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
}

/* ===================================================================
 * Mobile Responsiveness
 * =================================================================== */
@media screen and (max-width: 768px) {
    section[data-testid="stSidebar"] {
        display: none !important;
    }
    
    .main .block-container {
        padding: 1rem;
    }
    
    /* Disable evaporation edge on mobile (no sidebar to account for) */
    .main .block-container::before {
        left: 0;
    }
    
    .welcome-text {
        padding: 2rem 0.5rem 1rem 0.5rem;
    }
    
    .welcome-text .ephemer,
    .welcome-text .al {
        font-size: 1.8em;
    }
    
    .welcome-wordmark {
        max-height: 45px;
    }
    
    .stChatMessage p,
    .stChatInput textarea {
        font-size: 1rem !important;
    }
    
    .right-align-block {
        font-size: 0.9rem;
        padding: 0 0.5rem;
    }
}

/* ===================================================================
 * Scrollbar Styling (subtle, modern)
 * =================================================================== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-subtle);
}
